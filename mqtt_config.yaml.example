# Конфигурация MQTT брокеров для Meshtastic Telegram Bot
# Этот файл используется для настройки основного MQTT брокера и списка прокси-брокеров
# 
# Обратная совместимость: если файл не найден или не содержит нужных настроек,
# используются значения из .env файла (переменные окружения)

# Основной MQTT брокер (источник данных)
mqtt_source:
  host: mosquitto  # Для Docker Compose используйте имя сервиса 'mosquitto'
                   # Для локального запуска используйте 'localhost'
  port: 1883
  username: ""  # Оставьте пустым, если не требуется аутентификация
  password: ""  # Оставьте пустым, если не требуется аутентификация
  topic: msh/#
  client_id: meshtastic-telegram-bot
  keepalive: 60
  qos: 1  # QoS уровень подписки (0, 1 или 2)
  payload_format: json  # json | protobuf | both

# Список прокси-брокеров (можно добавить несколько)
mqtt_proxy_targets:
  - name: external_broker_1
    host: external.mqtt.broker.com
    port: 1883
    username: ""  # Оставьте пустым, если не требуется аутентификация
    password: ""  # Оставьте пустым, если не требуется аутентификация
    topic_prefix: ""  # Префикс для топика (опционально)
    client_id: ""  # Оставьте пустым для автоматической генерации
    enabled: true  # Включить/выключить этот прокси
    qos: 1  # QoS уровень публикации (0, 1 или 2)
    tls: false  # Использовать TLS/SSL (обычно true для порта 8883)
    tls_insecure: false  # Отключить проверку сертификата (только для самоподписанных)
  
  # Пример второго прокси-брокера с TLS:
  # - name: external_broker_2
  #   host: secure.mqtt.broker.com
  #   port: 8883  # Стандартный порт для MQTT over TLS
  #   username: user2
  #   password: pass2
  #   topic_prefix: meshtastic/
  #   client_id: meshtastic-proxy-2
  #   enabled: true
  #   qos: 1
  #   tls: true  # Включить TLS для порта 8883
  #   tls_insecure: false  # Проверять сертификат (рекомендуется)
  
  # Пример с самоподписанным сертификатом:
  # - name: internal_broker
  #   host: internal.mqtt.local
  #   port: 8883
  #   username: ""
  #   password: ""
  #   topic_prefix: ""
  #   client_id: ""
  #   enabled: true
  #   qos: 1
  #   tls: true
  #   tls_insecure: true  # Отключить проверку для самоподписанного сертификата

  # Конфигурация обработки сообщений
message_processing:
  # Режим обработки по умолчанию (используется если не определен из топика)
  # Возможные значения: private, group, all
  default_mode: group
  
  # Настройки режима GROUP
  group_mode_send_to_users: false  # Отправлять личные сообщения в режиме GROUP
  
  # Конфигурация обработчиков (можно легко добавлять новые)
  handlers:
    proxy:
      enabled: true
      priority: 0  # Порядок выполнения (меньше = раньше)
    
    telegram:
      enabled: true
      priority: 1
    
    # Пример: легко добавить новый обработчик
    # logging:
    #   enabled: true
    #   priority: 2
    #   log_file: "messages.log"

