# Meshtastic MQTT Telegram Bot

–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—É—á–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –≤–∞—à–µ–π Meshtastic –Ω–æ–¥—ã —á–µ—Ä–µ–∑ MQTT –±—Ä–æ–∫–µ—Ä –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∏—Ö –≤ Telegram. –û—Ç–ª–∏—á–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–µ—Ç–∏ Meshtastic –∏ –ø–æ–ª—É—á–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø—Ä—è–º–æ –≤ Telegram.

## üöÄ –ë—ã—Å—Ç—Ä–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ (5 –º–∏–Ω—É—Ç)

–ï—Å–ª–∏ –≤—ã –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–∏ —Å Docker –∏–ª–∏ Python - –Ω–µ –ø–µ—Ä–µ–∂–∏–≤–∞–π—Ç–µ! –Ø –ø–æ—Å—Ç–∞—Ä–∞–ª—Å—è —Å–¥–µ–ª–∞—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø—Ä–æ—Å—Ç–æ–π. –°–ª–µ–¥—É–π—Ç–µ —à–∞–≥–∞–º –ø–æ –ø–æ—Ä—è–¥–∫—É.

### –ß—Ç–æ –≤–∞–º –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è

1. **–ö–æ–º–ø—å—é—Ç–µ—Ä —Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º Docker** (Windows, Mac –∏–ª–∏ Linux)
   - –ï—Å–ª–∏ Docker –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, —Å–∫–∞—á–∞–π—Ç–µ —Å [–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Å–∞–π—Ç–∞](https://www.docker.com/products/docker-desktop/)
   - –ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ Docker Desktop –∑–∞–ø—É—Å—Ç–∏—Ç–µ –µ–≥–æ –∏ –¥–æ–∂–¥–∏—Ç–µ—Å—å –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏

2. **Telegram –±–æ—Ç** (–±–µ—Å–ø–ª–∞—Ç–Ω–æ, —Å–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞ 2 –º–∏–Ω—É—Ç—ã)
   - –û—Ç–∫—Ä–æ–π—Ç–µ Telegram –∏ –Ω–∞–π–¥–∏—Ç–µ –±–æ—Ç–∞ [@BotFather](https://t.me/BotFather)
   - –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/newbot` –∏ —Å–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ (–≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ `123456789:ABCdefGHIjklMNOpqrsTUVwxyz`)

3. **Meshtastic –Ω–æ–¥–∞** (—É–∂–µ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∏ —Ä–∞–±–æ—Ç–∞—Ç—å)

### –®–∞–≥ 1: –°–∫–∞—á–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç

–û—Ç–∫—Ä–æ–π—Ç–µ —Ç–µ—Ä–º–∏–Ω–∞–ª (–∏–ª–∏ PowerShell –Ω–∞ Windows) –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
git clone <repository-url>
cd Meshtastic_MQTT_bot
```

–ï—Å–ª–∏ —É –≤–∞—Å –Ω–µ—Ç Git, –ø—Ä–æ—Å—Ç–æ —Å–∫–∞—á–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç –∫–∞–∫ ZIP-–∞—Ä—Ö–∏–≤ –∏ —Ä–∞—Å–ø–∞–∫—É–π—Ç–µ –µ–≥–æ.

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

1. –ù–∞–π–¥–∏—Ç–µ —Ñ–∞–π–ª `env.example` –≤ –ø–∞–ø–∫–µ –ø—Ä–æ–µ–∫—Ç–∞
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –µ–≥–æ –∏ –ø–µ—Ä–µ–∏–º–µ–Ω—É–π—Ç–µ –≤ `.env` (—Ç–æ—á–∫–∞ –≤ –Ω–∞—á–∞–ª–µ –≤–∞–∂–Ω–∞!)
3. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –ª—é–±–æ–º —Ç–µ–∫—Å—Ç–æ–≤–æ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ (–ë–ª–æ–∫–Ω–æ—Ç, Notepad++, VS Code - —á—Ç–æ —É–≥–æ–¥–Ω–æ)

4. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è:

```env
# –í—Å—Ç–∞–≤—å—Ç–µ —Ç–æ–∫–µ–Ω –≤–∞—à–µ–≥–æ –±–æ—Ç–∞ (–ø–æ–ª—É—á–∏–ª–∏ –æ—Ç @BotFather)
TELEGRAM_BOT_TOKEN=123456789:ABCdefGHIjklMNOpqrsTUVwxyz

# ID –≥—Ä—É–ø–ø–æ–≤–æ–≥–æ —á–∞—Ç–∞ (–ø–æ–∫–∞ –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, –Ω–∞—Å—Ç—Ä–æ–∏–º –ø–æ–∑–∂–µ)
TELEGRAM_GROUP_CHAT_ID=

# –í–∞—à–∏ Telegram ID (–º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –≤—Å–µ–º)
TELEGRAM_ALLOWED_USER_IDS=

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ MQTT –±—Ä–æ–∫–µ—Ä–∞ (–¥–ª—è Docker –æ—Å—Ç–∞–≤—å—Ç–µ –∫–∞–∫ –µ—Å—Ç—å)
MQTT_SOURCE_HOST=mosquitto
MQTT_SOURCE_PORT=1883
MQTT_SOURCE_TOPIC=msh/#
```

**–í–∞–∂–Ω–æ:** –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–∞–≤—ã—á–∫–∏ –≤–æ–∫—Ä—É–≥ –∑–Ω–∞—á–µ–Ω–∏–π! –ü—Ä–æ—Å—Ç–æ –ø–∏—à–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∑–Ω–∞–∫–∞ `=`

### –®–∞–≥ 3: –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞

–í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ (–≤ –ø–∞–ø–∫–µ –ø—Ä–æ–µ–∫—Ç–∞) –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
docker-compose up -d
```

–≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞:
- –°–∫–∞—á–∞–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –æ–±—Ä–∞–∑—ã (–µ—Å–ª–∏ –∏—Ö –µ—â–µ –Ω–µ—Ç)
- –ó–∞–ø—É—Å—Ç–∏—Ç MQTT –±—Ä–æ–∫–µ—Ä (Mosquitto)
- –ó–∞–ø—É—Å—Ç–∏—Ç Telegram –±–æ—Ç–∞
- –í—Å–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ –±–æ—Ç–∞:

```bash
docker-compose logs -f telegram-bot
```

–í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å —á—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ:
```
INFO - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Meshtastic Telegram Bot
INFO - –ó–∞–ø—É—Å–∫ Meshtastic Telegram Bot
INFO - –£—Å–ø–µ—à–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ MQTT –±—Ä–æ–∫–µ—Ä—É
INFO - –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ –∏ –≥–æ—Ç–æ–≤–æ –∫ —Ä–∞–±–æ—Ç–µ
```

–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ –æ—à–∏–±–∫–∏ - –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –∫ —Ä–∞–∑–¥–µ–ª—É "–†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º" –Ω–∏–∂–µ.

### –®–∞–≥ 5: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –≥—Ä—É–ø–ø–æ–≤–æ–π —á–∞—Ç

1. –°–æ–∑–¥–∞–π—Ç–µ –≥—Ä—É–ø–ø—É –≤ Telegram (–∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é)
2. –î–æ–±–∞–≤—å—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø—É
3. –î–∞–π—Ç–µ –±–æ—Ç—É –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
4. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –≤ –≥—Ä—É–ø–ø–µ –∫–æ–º–∞–Ω–¥—É `/get_chat_id`
5. –ë–æ—Ç –æ—Ç–≤–µ—Ç–∏—Ç —Å ID —á–∞—Ç–∞ (–æ–±—ã—á–Ω–æ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ —á–∏—Å–ª–æ, –Ω–∞–ø—Ä–∏–º–µ—Ä `-1001234567890`)
6. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `.env` –∏ –≤—Å—Ç–∞–≤—å—Ç–µ —ç—Ç–æ—Ç ID:
   ```env
   TELEGRAM_GROUP_CHAT_ID=-1001234567890
   ```
7. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞:
   ```bash
   docker-compose restart telegram-bot
   ```

–ì–æ—Ç–æ–≤–æ! –¢–µ–ø–µ—Ä—å —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –≤–∞—à–µ–π Meshtastic –Ω–æ–¥—ã –±—É–¥—É—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –≤ Telegram.

---

## üì° –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Meshtastic –Ω–æ–¥—ã

–ß—Ç–æ–±—ã –Ω–æ–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∞ –¥–∞–Ω–Ω—ã–µ –Ω–∞ –≤–∞—à MQTT –±—Ä–æ–∫–µ—Ä, –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å MQTT –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ Meshtastic.

### –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ IP –∞–¥—Ä–µ—Å –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞

**–ù–∞ Windows:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É (Win+R, –≤–≤–µ–¥–∏—Ç–µ `cmd`)
2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ: `ipconfig`
3. –ù–∞–π–¥–∏—Ç–µ "IPv4-–∞–¥—Ä–µ—Å" (–æ–±—ã—á–Ω–æ —á—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ `192.168.1.100`)

**–ù–∞ Linux/Mac:**
```bash
ip addr show  # –∏–ª–∏ ifconfig
```

### –ù–∞—Å—Ç—Ä–æ–π—Ç–µ MQTT –≤ Meshtastic

1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ Meshtastic –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–æ–¥—ã
3. –ù–∞–π–¥–∏—Ç–µ —Ä–∞–∑–¥–µ–ª "MQTT" –∏–ª–∏ "Network"
4. –í–∫–ª—é—á–∏—Ç–µ MQTT
5. –£–∫–∞–∂–∏—Ç–µ:
   - **MQTT Server:** `–í–ê–®_IP_–ê–î–†–ï–°:1883`
     - –ù–∞–ø—Ä–∏–º–µ—Ä: `192.168.1.100:1883`
   - **MQTT Topic:** –≤—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤:
     - `msh` - —Ä–µ–∂–∏–º ALL (–≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è - –∏ –≤ –≥—Ä—É–ø–ø—É, –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º)
     - `msh/group` - —Ä–µ–∂–∏–º GROUP (—Ç–æ–ª—å–∫–æ –≥—Ä—É–ø–ø–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è)
     - `msh/private/{–≤–∞—à_telegram_id}` - —Ä–µ–∂–∏–º PRIVATE (—Ç–æ–ª—å–∫–æ –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è)
       - –£–∑–Ω–∞–π—Ç–µ –≤–∞—à Telegram ID —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É `/id` –≤ –±–æ—Ç–µ
       - –ù–∞–ø—Ä–∏–º–µ—Ä: `msh/private/123456789`
     - `msh/private/{–≤–∞—à_telegram_id}/group` - —Ä–µ–∂–∏–º PRIVATE_GROUP (–ª–∏—á–Ω—ã–µ + –≥—Ä—É–ø–ø–∞)
   - **Client Proxy Enabled:** –≤—ã–∫–ª—é—á–∏—Ç–µ (–µ—Å–ª–∏ –Ω–µ –Ω—É–∂–Ω–∞ –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω—è—è —Å–≤—è–∑—å)
6. –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ: –æ—Ç–∫–ª. (—Ç–∞–∫ –∫–∞–∫ protobuf —Ñ–æ—Ä–º–∞—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ–º)
7. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ MQTT —Ç–æ–ø–∏–∫–∞. –í—ã –º–æ–∂–µ—Ç–µ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–∞–∑–Ω—ã–µ –Ω–æ–¥—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–µ–∂–∏–º–æ–≤ —Ä–∞–±–æ—Ç—ã.

### –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

1. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ Mosquitto:
   ```bash
   docker-compose logs -f mosquitto
   ```

2. –í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å —á—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ:
   ```
   New client connected from 192.168.1.50:54321 as !698535e0
   ```

3. –ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ –æ—à–∏–±–∫–∏ - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
   - –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ —É–∫–∞–∑–∞–Ω IP –∞–¥—Ä–µ—Å
   - –û—Ç–∫—Ä—ã—Ç –ª–∏ –ø–æ—Ä—Ç 1883 –≤ —Ñ–∞–π—Ä–≤–æ–ª–µ
   - –ù–∞—Ö–æ–¥—è—Ç—Å—è –ª–∏ –Ω–æ–¥–∞ –∏ —Å–µ—Ä–≤–µ—Ä –≤ –æ–¥–Ω–æ–π —Å–µ—Ç–∏ Wi-Fi

---

## üèóÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞: —á—Ç–æ –∑–∞ —á—Ç–æ –æ—Ç–≤–µ—á–∞–µ—Ç

–î–∞–≤–∞–π—Ç–µ —Ä–∞–∑–±–µ—Ä–µ–º—Å—è, –∫–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω —ç—Ç–æ—Ç –±–æ—Ç. –ù–µ –ø—É–≥–∞–π—Ç–µ—Å—å - —è –æ–±—ä—è—Å–Ω—é –ø—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏.

### –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ë–æ—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø—É "—Å–ª–æ–µ–Ω–æ–≥–æ –ø–∏—Ä–æ–≥–∞" - –∫–∞–∂–¥—ã–π —Å–ª–æ–π –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Å–≤–æ—é –∑–∞–¥–∞—á—É:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Application (–û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è)         ‚îÇ  ‚Üê –£–ø—Ä–∞–≤–ª—è–µ—Ç –≤—Å–µ–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ   Handlers (–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏)            ‚îÇ  ‚Üê –†–µ–∞–≥–∏—Ä—É—é—Ç –Ω–∞ —Å–æ–±—ã—Ç–∏—è
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ   Services (–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞)          ‚îÇ  ‚Üê –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –¥–∞–Ω–Ω—ã–µ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ   Repositories (–•—Ä–∞–Ω–∏–ª–∏—â–∞)          ‚îÇ  ‚Üê –†–∞–±–æ—Ç–∞—é—Ç —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ   Domain (–ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö)            ‚îÇ  ‚Üê –û–ø–∏—Å—ã–≤–∞—é—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îî
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫

```
Meshtastic_MQTT_bot/
‚îú‚îÄ‚îÄ src/                          # –í–µ—Å—å –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥
‚îÇ   ‚îú‚îÄ‚îÄ application/              # –ì–ª–∞–≤–Ω—ã–π "–¥–∏—Ä–∏–∂–µ—Ä" –æ—Ä–∫–µ—Å—Ç—Ä–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ app.py                # –ó–∞–ø—É—Å–∫–∞–µ—Ç –∏ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ domain/                   # –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö (–∫–∞–∫ "—á–µ—Ä—Ç–µ–∂–∏")
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ message.py            # –û–ø–∏—Å—ã–≤–∞–µ—Ç, –∫–∞–∫ –≤—ã–≥–ª—è–¥–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ repo/                     # –†–∞–±–æ—Ç–∞ —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ mqtt_repository.py    # –ß–∏—Ç–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ MQTT
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ telegram_repository.py # –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ Telegram
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ service/                  # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (–æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ message_service.py    # –ü–∞—Ä—Å–∏—Ç MQTT —Å–æ–æ–±—â–µ–Ω–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ mqtt_proxy_service.py # –ü–µ—Ä–µ—Å—ã–ª–∞–µ—Ç –≤ –¥—Ä—É–≥–∏–µ –±—Ä–æ–∫–µ—Ä—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ node_cache_service.py # –•—Ä–∞–Ω–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –Ω–æ–¥–∞—Ö
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ topic_routing_service.py # –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã –ø–æ —Ç–æ–ø–∏–∫—É
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ message_processing_strategy.py # –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ message_grouping_service.py # –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç —Ä–∞–∑–Ω—ã—Ö –Ω–æ–¥
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ handlers/                 # –†–µ–∞–≥–∏—Ä—É—é—Ç –Ω–∞ —Å–æ–±—ã—Ç–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ mqtt_handler.py       # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç MQTT —Å–æ–æ–±—â–µ–Ω–∏—è (legacy)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ telegram_commands.py  # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞ (/start, /help)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ message_handler_chain.py # –¶–µ–ø–æ—á–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ (Chain of Responsibility)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ handler_registry.py   # –†–µ–µ—Å—Ç—Ä –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ handler_factory.py    # –§–∞–±—Ä–∏–∫–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ concrete_handlers.py  # –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ message_handler_adapter.py # –ê–¥–∞–ø—Ç–µ—Ä –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ config.py                 # –í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ
‚îú‚îÄ‚îÄ main.py                        # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (–æ—Ç—Å—é–¥–∞ –≤—Å–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è)
‚îú‚îÄ‚îÄ docker-compose.yml             # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Docker
‚îú‚îÄ‚îÄ Dockerfile                     # –ö–∞–∫ —Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑ –±–æ—Ç–∞
‚îú‚îÄ‚îÄ requirements.txt               # –°–ø–∏—Å–æ–∫ –±–∏–±–ª–∏–æ—Ç–µ–∫ Python
‚îú‚îÄ‚îÄ .env                           # –í–∞—à–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (—Å–æ–∑–¥–∞–µ—Ç–µ —Å–∞–º–∏)
‚îî‚îÄ‚îÄ mqtt_config.yaml.example       # –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ MQTT (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```

---

## üìö –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### 1. Domain (–î–æ–º–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏) - `src/domain/`

–≠—Ç–æ "—á–µ—Ä—Ç–µ–∂–∏" –¥–∞–Ω–Ω—ã—Ö. –û–ø–∏—Å—ã–≤–∞—é—Ç, –∫–∞–∫ –≤—ã–≥–ª—è–¥—è—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç Meshtastic.

#### `message.py` - –ú–æ–¥–µ–ª—å —Å–æ–æ–±—â–µ–Ω–∏—è

**–ö–ª–∞—Å—Å:** `MeshtasticMessage`

–≠—Ç–æ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å, –∫–æ—Ç–æ—Ä—ã–π –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç Meshtastic. –ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ –µ–≥–æ –∫–∞–∫ —Ñ–æ—Ä–º—É, –∫–æ—Ç–æ—Ä—É—é –Ω—É–∂–Ω–æ –∑–∞–ø–æ–ª–Ω–∏—Ç—å.

**–û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è (–∞—Ç—Ä–∏–±—É—Ç—ã):**

- `topic` - –æ—Ç–∫—É–¥–∞ –ø—Ä–∏—à–ª–æ —Å–æ–æ–±—â–µ–Ω–∏–µ (MQTT —Ç–æ–ø–∏–∫)
- `from_node` - –∫—Ç–æ –æ—Ç–ø—Ä–∞–≤–∏–ª (ID –Ω–æ–¥—ã, –Ω–∞–ø—Ä–∏–º–µ—Ä `!698535e0`)
- `from_node_name` - –∏–º—è –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, "NCH.PT.0.63 (Ruslan)")
- `from_node_short` - –∫–æ—Ä–æ—Ç–∫–æ–µ –∏–º—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, "35e0")
- `to_node` - –∫–æ–º—É –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ (–∏–ª–∏ "–í—Å–µ–º" –µ—Å–ª–∏ `4294967295`)
- `text` - —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
- `timestamp` - –∫–æ–≥–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ (Unix timestamp)
- `rssi` - –∫–∞—á–µ—Å—Ç–≤–æ —Å–∏–≥–Ω–∞–ª–∞ (—á–µ–º –±–ª–∏–∂–µ –∫ 0, —Ç–µ–º –ª—É—á—à–µ)
- `snr` - –æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Å–∏–≥–Ω–∞–ª/—à—É–º
- `hops_away` - —Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ —Ä–µ—Ç—Ä–∞–Ω—Å–ª–∏—Ä–æ–≤–∞–Ω–æ (0 = –ø—Ä—è–º–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞)
- `message_type` - —Ç–∏–ø —Å–æ–æ–±—â–µ–Ω–∏—è (`text`, `nodeinfo`, `position`)

**–ú–µ—Ç–æ–¥—ã:**

- `format_for_telegram()` - –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∫—Ä–∞—Å–∏–≤—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è Telegram
  - –î–æ–±–∞–≤–ª—è–µ—Ç —ç–º–æ–¥–∑–∏
  - –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è
  - –î–æ–±–∞–≤–ª—è–µ—Ç —Å—Å—ã–ª–∫—É –Ω–∞ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ (–µ—Å–ª–∏ –µ—Å—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã)
  - –≠–∫—Ä–∞–Ω–∏—Ä—É–µ—Ç HTML –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

- `format_for_telegram_with_grouping()` - —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —É—á–µ—Ç–æ–º –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –Ω–æ–¥-–ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π
  - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –Ω–æ–¥, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª—É—á–∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ
  - –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Ä–µ–º—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–∞–∂–¥–æ–π –Ω–æ–¥–æ–π
  - –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ —Å–∏–≥–Ω–∞–ª–∞ –¥–ª—è –∫–∞–∂–¥–æ–π –Ω–æ–¥—ã
  - –ë–ª–æ–∫ "üì• –ü–æ–ª—É—á–µ–Ω–æ –Ω–æ–¥–∞–º–∏:" —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω –Ω–∞–¥ –±–ª–æ–∫–æ–º –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è

- `get_rssi_quality_emoji()` - –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ü–≤–µ—Ç —ç–º–æ–¥–∑–∏ –ø–æ –∫–∞—á–µ—Å—Ç–≤—É —Å–∏–≥–Ω–∞–ª–∞
  - üü¢ –û—Ç–ª–∏—á–Ω—ã–π (> -80 dBm)
  - üü° –ù–æ—Ä–º–∞–ª—å–Ω—ã–π (-80 –¥–æ -100 dBm)
  - üî¥ –ü–ª–æ—Ö–æ–π (-100 –¥–æ -120 dBm)
  - ‚ö´ –û—á–µ–Ω—å –ø–ª–æ—Ö–æ–π (< -120 dBm)

- `get_snr_quality_emoji()` - –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è SNR

---

### 2. Repository (–•—Ä–∞–Ω–∏–ª–∏—â–∞) - `src/repo/`

–≠—Ç–∏ –∫–ª–∞—Å—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞–ø—Ä—è–º—É—é —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏ - MQTT –±—Ä–æ–∫–µ—Ä–æ–º –∏ Telegram API.

#### `mqtt_repository.py` - –†–∞–±–æ—Ç–∞ —Å MQTT

**–ö–ª–∞—Å—Å:** `AsyncMQTTRepository`

–û—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MQTT –±—Ä–æ–∫–µ—Ä—É –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π.

**–ú–µ—Ç–æ–¥—ã:**

- `connect()` - –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ –±—Ä–æ–∫–µ—Ä—É
  - –°–æ–∑–¥–∞–µ—Ç MQTT –∫–ª–∏–µ–Ω—Ç
  - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
  - –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (username, password, keepalive)

- `disconnect()` - –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è –æ—Ç –±—Ä–æ–∫–µ—Ä–∞
  - –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
  - –û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç —Ä–µ—Å—É—Ä—Å—ã

- `subscribe(topic, qos)` - –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —Ç–æ–ø–∏–∫
  - `topic` - –Ω–∞ –∫–∞–∫–æ–π —Ç–æ–ø–∏–∫ –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, `msh/#` –¥–ª—è –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π)
  - `qos` - —É—Ä–æ–≤–µ–Ω—å –∫–∞—á–µ—Å—Ç–≤–∞ (0, 1 –∏–ª–∏ 2)

- `publish(topic, payload, qos)` - –ø—É–±–ª–∏–∫—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–∏—Å–æ–º –¥–ª—è –ø–µ—Ä–µ—Å—ã–ª–∫–∏

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

1. –ë–æ—Ç –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ MQTT –±—Ä–æ–∫–µ—Ä—É (Mosquitto)
2. –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —Ç–æ–ø–∏–∫ `msh/#` (–ø–æ–ª—É—á–∞–µ—Ç –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç Meshtastic)
3. –ö–æ–≥–¥–∞ Meshtastic –Ω–æ–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ, –±—Ä–æ–∫–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç –µ–≥–æ
4. –ë—Ä–æ–∫–µ—Ä –ø–µ—Ä–µ–¥–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç—É
5. –ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ñ–æ—Ä–º–∞—Ç (JSON –∏–ª–∏ Protobuf) –∏ –ø–∞—Ä—Å–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ
6. –ë–æ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ Telegram

#### `telegram_repository.py` - –†–∞–±–æ—Ç–∞ —Å Telegram

**–ö–ª–∞—Å—Å:** `AsyncTelegramRepository`

–û—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –æ—Ç–ø—Ä–∞–≤–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π –≤ Telegram.

**–ú–µ—Ç–æ–¥—ã:**

- `send_message(chat_id, text, parse_mode)` - –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç
  - `chat_id` - ID —á–∞—Ç–∞ (–≥—Ä—É–ø–ø—ã –∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
  - `text` - —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
  - `parse_mode` - —Ñ–æ—Ä–º–∞—Ç (HTML –¥–ª—è —Å—Å—ã–ª–æ–∫ –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
  - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç ID –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è

- `send_to_group(text)` - –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ –≥—Ä—É–ø–ø–æ–≤–æ–π —á–∞—Ç
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `group_chat_id` –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
  - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç ID –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è (–¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏)

- `send_to_user(user_id, text)` - –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤ –ª–∏—á–Ω—ã–π —á–∞—Ç
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —Ä–∞–∑—Ä–µ—à–µ–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å

- `edit_message(chat_id, message_id, text, parse_mode)` - —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
  - –û–±–Ω–æ–≤–ª—è–µ—Ç —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è, –¥–æ–±–∞–≤–ª—è—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –Ω–æ–≤—ã—Ö –Ω–æ–¥–∞—Ö-–ø–æ–ª—É—á–∞—Ç–µ–ª—è—Ö

- `edit_group_message(message_id, text)` - —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –≥—Ä—É–ø–ø–æ–≤–æ–º —á–∞—Ç–µ
  - –£–¥–æ–±–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≥—Ä—É–ø–ø–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

- `is_user_allowed(user_id)` - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - –ï—Å–ª–∏ `allowed_user_ids` –Ω–µ –∑–∞–¥–∞–Ω - —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –≤—Å–µ–º
  - –ò–Ω–∞—á–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –µ—Å—Ç—å –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ —Å–ø–∏—Å–∫–µ

---

### 3. Service (–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞) - `src/service/`

–ó–¥–µ—Å—å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö - –ø–∞—Ä—Å–∏–Ω–≥, –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ, –ø–µ—Ä–µ—Å—ã–ª–∫–∞.

#### `message_service.py` - –ü–∞—Ä—Å–∏–Ω–≥ —Å–æ–æ–±—â–µ–Ω–∏–π

**–ö–ª–∞—Å—Å:** `MessageService`

–ü—Ä–µ–≤—Ä–∞—â–∞–µ—Ç —Å—ã—Ä—ã–µ MQTT —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–≤–∞ —Ñ–æ—Ä–º–∞—Ç–∞: JSON –∏ Protobuf.

**–ú–µ—Ç–æ–¥—ã:**

- `parse_mqtt_message(topic, payload)` - –ø–∞—Ä—Å–∏—Ç MQTT —Å–æ–æ–±—â–µ–Ω–∏–µ
  - –ü—Ä–∏–Ω–∏–º–∞–µ—Ç —Ç–æ–ø–∏–∫ –∏ –¥–∞–Ω–Ω—ã–µ (–±–∞–π—Ç—ã)
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ñ–æ—Ä–º–∞—Ç –ø–æ —Ç–æ–ø–∏–∫—É –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ `payload_format`
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –ø–∞—Ä—Å–µ—Ä (JSON –∏–ª–∏ Protobuf)
  - –ò–∑–≤–ª–µ–∫–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –Ω–æ–¥–∞—Ö –∏–∑ –∫—ç—à–∞
  - –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø —Å–æ–æ–±—â–µ–Ω–∏—è (`text`, `nodeinfo`, `position`)
  - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç `MeshtasticMessage`

**–ü–∞—Ä—Å–µ—Ä—ã:**

–ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–≤–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ø–∞—Ä—Å–µ—Ä–∞ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤:

1. **`JsonMessageParser`** - –¥–ª—è JSON —Å–æ–æ–±—â–µ–Ω–∏–π
   - –î–µ–∫–æ–¥–∏—Ä—É–µ—Ç UTF-8 —Ç–µ–∫—Å—Ç
   - –ü–∞—Ä—Å–∏—Ç JSON —Å—Ç—Ä—É–∫—Ç—É—Ä—É
   - –ò–∑–≤–ª–µ–∫–∞–µ—Ç –ø–æ–ª—è –Ω–∞–ø—Ä—è–º—É—é –∏–∑ JSON

2. **`ProtobufMessageParser`** - –¥–ª—è Protobuf —Å–æ–æ–±—â–µ–Ω–∏–π
   - –î–µ–∫–æ–¥–∏—Ä—É–µ—Ç –±–∏–Ω–∞—Ä–Ω—ã–π protobuf —á–µ—Ä–µ–∑ `meshtastic.protobuf.mqtt_pb2`
   - –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ `portnum` (TEXT_MESSAGE_APP, NODEINFO_APP, POSITION_APP –∏ —Ç.–¥.)
   - –î–µ–∫–æ–¥–∏—Ä—É–µ—Ç payload –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞:
     - –¢–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è - –¥–µ–∫–æ–¥–∏—Ä—É–µ—Ç UTF-8
     - –°–∂–∞—Ç—ã–µ —Ç–µ–∫—Å—Ç—ã - —Ä–∞—Å–ø–∞–∫–æ–≤—ã–≤–∞–µ—Ç —á–µ—Ä–µ–∑ Unishox2 (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
     - Nodeinfo - –ø–∞—Ä—Å–∏—Ç —á–µ—Ä–µ–∑ `mesh_pb2.User`
     - Position - –ø–∞—Ä—Å–∏—Ç —á–µ—Ä–µ–∑ `mesh_pb2.Position`
     - Telemetry - –ø–∞—Ä—Å–∏—Ç —á–µ—Ä–µ–∑ `telemetry_pb2.Telemetry`
     - –ò –¥—Ä—É–≥–∏–µ —Ç–∏–ø—ã –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
   - –í—ã—á–∏—Å–ª—è–µ—Ç `hops_away` –∫–∞–∫ `hop_start - hop_limit`

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

1. –ü–æ–ª—É—á–∞–µ—Ç —Å—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç MQTT –±—Ä–æ–∫–µ—Ä–∞
2. –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ñ–æ—Ä–º–∞—Ç –ø–æ —Ç–æ–ø–∏–∫—É:
   - –¢–æ–ø–∏–∫–∏ —Å `/e/` (–±–µ–∑ `/json/`) - protobuf —Ñ–æ—Ä–º–∞—Ç
   - –¢–æ–ø–∏–∫–∏ —Å `/json/` - JSON —Ñ–æ—Ä–º–∞—Ç
3. –í—ã–±–∏—Ä–∞–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –ø–∞—Ä—Å–µ—Ä
4. –ü–∞—Ä—Å–µ—Ä –∏–∑–≤–ª–µ–∫–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø —Å–æ–æ–±—â–µ–Ω–∏—è
5. –ï—Å–ª–∏ —ç—Ç–æ `nodeinfo` - –æ–±–Ω–æ–≤–ª—è–µ—Ç –∫—ç—à –Ω–æ–¥ (–∏–º–µ–Ω–∞, ID)
6. –ï—Å–ª–∏ —ç—Ç–æ `position` - –æ–±–Ω–æ–≤–ª—è–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ –∫—ç—à–µ
7. –ï—Å–ª–∏ —ç—Ç–æ `text` - –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–µ–∫—Å—Ç –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª–µ
8. –°–æ–∑–¥–∞–µ—Ç –æ–±—ä–µ–∫—Ç `MeshtasticMessage` —Å–æ –≤—Å–µ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞:**

–í `.env` –∏–ª–∏ `mqtt_config.yaml` –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å:
- `MQTT_SOURCE_PAYLOAD_FORMAT=json` - —Ç–æ–ª—å–∫–æ JSON (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- `MQTT_SOURCE_PAYLOAD_FORMAT=protobuf` - —Ç–æ–ª—å–∫–æ Protobuf
- `MQTT_SOURCE_PAYLOAD_FORMAT=both` - –æ–±–∞ —Ñ–æ—Ä–º–∞—Ç–∞ (–º–æ–∂–µ—Ç –±—ã—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ)

#### `node_cache_service.py` - –ö—ç—à –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –Ω–æ–¥–∞—Ö

**–ö–ª–∞—Å—Å:** `NodeCacheService`

–•—Ä–∞–Ω–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –Ω–æ–¥–∞—Ö Meshtastic: –∏–º–µ–Ω–∞, –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã, –∫–æ–≥–¥–∞ –æ–±–Ω–æ–≤–ª—è–ª–∏—Å—å.

**–ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ:**

Meshtastic –Ω–æ–¥—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç —Ä–∞–∑–Ω—ã–µ —Ç–∏–ø—ã —Å–æ–æ–±—â–µ–Ω–∏–π:
- `text` - —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (—á–∞—Å—Ç–æ –±–µ–∑ –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª–µ)
- `nodeinfo` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –Ω–æ–¥–µ (–∏–º—è, ID)
- `position` - –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –Ω–æ–¥—ã

–ß—Ç–æ–±—ã –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫—Ä–∞—Å–∏–≤—ã–µ –∏–º–µ–Ω–∞ –≤–º–µ—Å—Ç–æ ID, –±–æ—Ç –∫—ç—à–∏—Ä—É–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –Ω–æ–¥–∞—Ö.

**–ú–µ—Ç–æ–¥—ã:**

- `update_node_info(node_id, longname, shortname)` - –æ–±–Ω–æ–≤–ª—è–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –Ω–æ–¥–µ
  - **–í—Å–µ–≥–¥–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç –∏–º–µ–Ω–∞ –≤ –ø–∞–º—è—Ç–∏** (–ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ `nodeinfo`)
  - –ù–∞ –¥–∏—Å–∫ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–æ–ª—å–∫–æ —Ä–∞–∑ –≤ 3 –¥–Ω—è (—á—Ç–æ–±—ã –Ω–µ –∏–∑–Ω–∞—à–∏–≤–∞—Ç—å –¥–∏—Å–∫)
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ `nodeinfo` —Å–æ–æ–±—â–µ–Ω–∏–π
  - **–í–∞–∂–Ω–æ:** –ò–º–µ–Ω–∞ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Å—Ä–∞–∑—É, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞ –¥–∏—Å–∫

- `update_node_position(node_id, latitude, longitude, altitude)` - –æ–±–Ω–æ–≤–ª—è–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
  - –í—Å–µ–≥–¥–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç –≤ –ø–∞–º—è—Ç–∏
  - –ù–∞ –¥–∏—Å–∫ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–æ–ª—å–∫–æ —Ä–∞–∑ –≤ 3 –¥–Ω—è (—á—Ç–æ–±—ã –Ω–µ –∏–∑–Ω–∞—à–∏–≤–∞—Ç—å –¥–∏—Å–∫)

- `get_node_name(node_id)` - –ø–æ–ª—É—á–∞–µ—Ç –∏–º—è –Ω–æ–¥—ã –∏–∑ –∫—ç—à–∞
  - –°–Ω–∞—á–∞–ª–∞ –∏—â–µ—Ç –≤ –ø–∞–º—è—Ç–∏
  - –ï—Å–ª–∏ –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç - –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Å –¥–∏—Å–∫–∞

- `get_node_shortname(node_id)` - –ø–æ–ª—É—á–∞–µ—Ç –∫–æ—Ä–æ—Ç–∫–æ–µ –∏–º—è

- `get_node_position(node_id)` - –ø–æ–ª—É—á–∞–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –Ω–æ–¥—ã

**–ì–¥–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è:**

- –í –ø–∞–º—è—Ç–∏ (–±—ã—Å—Ç—Ä–æ, –Ω–æ —Ç–µ—Ä—è–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ)
- –ù–∞ –¥–∏—Å–∫–µ –≤ —Ñ–∞–π–ª–µ `data/nodes_cache.json` (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –º–µ–∂–¥—É –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–º–∏)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–∞ –∫—ç—à–∞:**

```json
{
  "nodes": [
    {
      "node_id": "!698535e0",
      "longname": "NCH.PT.0.63 (Ruslan)",
      "shortname": "35e0",
      "latitude": 55.756899,
      "longitude": 52.463371,
      "altitude": 125,
      "last_updated": "2025-12-10T00:18:00",
      "last_position_updated": "2025-12-10T00:18:00"
    }
  ],
  "last_saved": "2025-12-10T00:18:00"
}
```

#### `message_grouping_service.py` - –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π

**–ö–ª–∞—Å—Å:** `MessageGroupingService`

–ì—Ä—É–ø–ø–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç —Ä–∞–∑–Ω—ã—Ö –Ω–æ–¥ —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º `message_id` –≤ –æ–¥–Ω–æ Telegram —Å–æ–æ–±—â–µ–Ω–∏–µ.

**–ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ:**

–ö–æ–≥–¥–∞ –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—É—á–∞—é—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –Ω–æ–¥, –≤–º–µ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–π –Ω–æ–¥—ã, –±–æ—Ç:
1. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ–¥–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –ø–æ–ª—É—á–µ–Ω–∏–∏
2. –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ, –¥–æ–±–∞–≤–ª—è—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –¥—Ä—É–≥–∏—Ö –Ω–æ–¥–∞—Ö-–ø–æ–ª—É—á–∞—Ç–µ–ª—è—Ö
3. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –Ω–æ–¥, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª—É—á–∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ

**–ú–µ—Ç–æ–¥—ã:**

- `get_or_create_group(message_id, telegram_message_id)` - –ø–æ–ª—É—á–∞–µ—Ç –∏–ª–∏ —Å–æ–∑–¥–∞–µ—Ç –≥—Ä—É–ø–ø—É —Å–æ–æ–±—â–µ–Ω–∏–π
- `add_received_node(message_id, message, receiver_node_id)` - –¥–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–¥—É-–ø–æ–ª—É—á–∞—Ç–µ–ª—è –≤ –≥—Ä—É–ø–ø—É
- `is_grouping_active(message_id)` - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –∞–∫—Ç–∏–≤–Ω–∞ –ª–∏ –µ—â–µ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ (–Ω–µ –∏—Å—Ç–µ–∫ —Ç–∞–π–º–∞—É—Ç)
- `cleanup_expired_groups()` - —É–¥–∞–ª—è–µ—Ç —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –≥—Ä—É–ø–ø—ã

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏:**

- `message_grouping_enabled` - –≤–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫—É (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `true`)
- `message_grouping_timeout` - —Ç–∞–π–º–∞—É—Ç –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 30)
- `show_receive_time` - –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤—Ä–µ–º—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–∞–∂–¥–æ–π –Ω–æ–¥–æ–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `false`)

**–ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã:**

1. –ù–æ–¥–∞ A –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å `message_id=123` ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–æ–≤–æ–µ Telegram —Å–æ–æ–±—â–µ–Ω–∏–µ
2. –ù–æ–¥–∞ B –ø–æ–ª—É—á–∞–µ—Ç —Ç–æ –∂–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (`message_id=123`) ‚Üí —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è "–ù–æ–¥–∞ B"
3. –ù–æ–¥–∞ C –ø–æ–ª—É—á–∞–µ—Ç —Ç–æ –∂–µ —Å–æ–æ–±—â–µ–Ω–∏–µ ‚Üí —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ, –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è "–ù–æ–¥–∞ C"
4. –ß–µ—Ä–µ–∑ 30 —Å–µ–∫—É–Ω–¥ (—Ç–∞–π–º–∞—É—Ç) –Ω–æ–≤—ã–µ –Ω–æ–¥—ã –±–æ–ª—å—à–µ –Ω–µ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è

#### `topic_routing_service.py` - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã –ø–æ —Ç–æ–ø–∏–∫—É

**–ö–ª–∞—Å—Å:** `TopicRoutingService`

–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–µ–∂–∏–º –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã MQTT —Ç–æ–ø–∏–∫–∞.

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ä–µ–∂–∏–º—ã:**

- `ALL` - –≤—Å–µ –ø–∞–∫–µ—Ç—ã (—Ç–æ–ø–∏–∫ `msh`)
- `PRIVATE` - —Ç–æ–ª—å–∫–æ –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (—Ç–æ–ø–∏–∫ `msh/private/{tg_id}`)
- `GROUP` - —Ç–æ–ª—å–∫–æ –≥—Ä—É–ø–ø–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (—Ç–æ–ø–∏–∫ `msh/group`)
- `PRIVATE_GROUP` - –ª–∏—á–Ω—ã–µ + –≥—Ä—É–ø–ø–∞ (—Ç–æ–ø–∏–∫ `msh/private/{tg_id}/group`)

**–ú–µ—Ç–æ–¥—ã:**

- `detect_mode_from_topic(topic)` - –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–µ–∂–∏–º –∏–∑ —Ç–æ–ø–∏–∫–∞
- `set_user_mode(tg_id, mode)` - —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ä–µ–∂–∏–º –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–æ–ø–∏–∫)
- `get_user_mode(tg_id)` - –ø–æ–ª—É—á–∞–µ—Ç —Ä–µ–∂–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `get_effective_mode(topic, tg_id)` - –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∏—Ç–æ–≥–æ–≤—ã–π —Ä–µ–∂–∏–º (—Å —É—á–µ—Ç–æ–º –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π)

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

1. –ù–æ–¥–∞ –ø—É–±–ª–∏–∫—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π —Ç–æ–ø–∏–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `msh/private/123456789`)
2. –ë–æ—Ç –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ç–æ–ø–∏–∫ –∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã
3. –°–æ–æ–±—â–µ–Ω–∏–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è —Å–æ–≥–ª–∞—Å–Ω–æ —Ä–µ–∂–∏–º—É (–æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ –ª–∏—á–Ω—ã–π —á–∞—Ç, –≤ –≥—Ä—É–ø–ø—É, –∏–ª–∏ –∏ —Ç—É–¥–∞, –∏ —Ç—É–¥–∞)

#### `message_processing_strategy.py` - –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π

**–ö–ª–∞—Å—Å:** `MessageProcessingStrategy` (–∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π)

–†–µ–∞–ª–∏–∑—É–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω Strategy –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–µ–∂–∏–º–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π.

**–†–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**

- `PrivateModeStrategy` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤ —Ä–µ–∂–∏–º–µ PRIVATE (—Ç–æ–ª—å–∫–æ –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è)
- `GroupModeStrategy` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤ —Ä–µ–∂–∏–º–µ GROUP (—Ç–æ–ª—å–∫–æ –≥—Ä—É–ø–ø–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è)
- `AllModeStrategy` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤ —Ä–µ–∂–∏–º–µ ALL (–≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è)

**–ú–µ—Ç–æ–¥—ã:**

- `should_process(message)` - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –Ω—É–∂–Ω–æ –ª–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
- `process_message(message, telegram_repo, node_cache_service)` - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ

#### `mqtt_proxy_service.py` - –ü–µ—Ä–µ—Å—ã–ª–∫–∞ –≤ –¥—Ä—É–≥–∏–µ –±—Ä–æ–∫–µ—Ä—ã

**–ö–ª–∞—Å—Å:** `MQTTProxyService`

–ü–µ—Ä–µ—Å—ã–ª–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –¥—Ä—É–≥–∏–µ MQTT –±—Ä–æ–∫–µ—Ä—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ –æ–±–ª–∞—á–Ω—ã–π –±—Ä–æ–∫–µ—Ä –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞).

**–ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ:**

- –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –æ–±–ª–∞–∫–æ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –¥—Ä—É–≥–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏
- –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π

**–ö–ª–∞—Å—Å:** `MQTTProxyTarget`

–ü—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –æ–¥–∏–Ω —Ü–µ–ª–µ–≤–æ–π –±—Ä–æ–∫–µ—Ä –¥–ª—è –ø—Ä–æ–∫—Å–∏.

**–ú–µ—Ç–æ–¥—ã:**

- `connect()` - –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ —Ü–µ–ª–µ–≤–æ–º—É –±—Ä–æ–∫–µ—Ä—É
- `disconnect()` - –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è
- `publish_message(message)` - –ø—É–±–ª–∏–∫—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ

**–ö–ª–∞—Å—Å:** `MQTTProxyService`

–£–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Ü–µ–ª–µ–≤—ã–º–∏ –±—Ä–æ–∫–µ—Ä–∞–º–∏.

**–ú–µ—Ç–æ–¥—ã:**

- `start()` - –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫–æ –≤—Å–µ–º –±—Ä–æ–∫–µ—Ä–∞–º **–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ**
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `asyncio.gather()` –¥–ª—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
  - –ï—Å–ª–∏ –æ–¥–∏–Ω –±—Ä–æ–∫–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω - –æ—Å—Ç–∞–ª—å–Ω—ã–µ –≤—Å–µ —Ä–∞–≤–Ω–æ –ø–æ–¥–∫–ª—é—á–∞—Ç—Å—è

- `stop()` - –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è –æ—Ç –≤—Å–µ—Ö –±—Ä–æ–∫–µ—Ä–æ–≤ **–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ**

- `proxy_message(message)` - –ø–µ—Ä–µ—Å—ã–ª–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤–æ –≤—Å–µ –±—Ä–æ–∫–µ—Ä—ã **–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ**
  - –≠—Ç–æ –∫–ª—é—á–µ–≤–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ! –í—Å–µ –±—Ä–æ–∫–µ—Ä—ã –ø–æ–ª—É—á–∞—é—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
  - –ï—Å–ª–∏ –æ–¥–∏–Ω –±—Ä–æ–∫–µ—Ä –º–µ–¥–ª–µ–Ω–Ω—ã–π - –æ—Å—Ç–∞–ª—å–Ω—ã–µ –Ω–µ –∂–¥—É—Ç

**–ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã:**

–î–æ —É–ª—É—á—à–µ–Ω–∏—è (–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ):
- –ë—Ä–æ–∫–µ—Ä 1: 100 –º—Å
- –ë—Ä–æ–∫–µ—Ä 2: 100 –º—Å
- –ë—Ä–æ–∫–µ—Ä 3: 100 –º—Å
- **–ò—Ç–æ–≥–æ: 300 –º—Å**

–ü–æ—Å–ª–µ —É–ª—É—á—à–µ–Ω–∏—è (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ):
- –í—Å–µ –±—Ä–æ–∫–µ—Ä—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ: 100 –º—Å
- **–ò—Ç–æ–≥–æ: 100 –º—Å (–≤ 3 —Ä–∞–∑–∞ –±—ã—Å—Ç—Ä–µ–µ!)**

---

### 4. Handlers (–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏) - `src/handlers/`

–≠—Ç–∏ –∫–ª–∞—Å—Å—ã —Ä–µ–∞–≥–∏—Ä—É—é—Ç –Ω–∞ —Å–æ–±—ã—Ç–∏—è - –ø—Ä–∏—Ö–æ–¥ MQTT —Å–æ–æ–±—â–µ–Ω–∏–π –∏–ª–∏ –∫–æ–º–∞–Ω–¥ –≤ Telegram.

#### `mqtt_handler.py` - –û–±—Ä–∞–±–æ—Ç–∫–∞ MQTT —Å–æ–æ–±—â–µ–Ω–∏–π (Legacy)

**–ö–ª–∞—Å—Å:** `MQTTMessageHandlerImpl`

–°—Ç–∞—Ä–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ MQTT —Å–æ–æ–±—â–µ–Ω–∏–π. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏.

**–ù–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:**

–ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω—ã **Chain of Responsibility**, **Strategy**, **Registry** –∏ **Factory** –¥–ª—è –≥–∏–±–∫–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π:

1. **Handler Chain** (`message_handler_chain.py`) - —Ü–µ–ø–æ—á–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
   - –ö–∞–∂–¥—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–ª–∏ –ø–µ—Ä–µ–¥–∞—Ç—å —Å–ª–µ–¥—É—é—â–µ–º—É
   - –ü–æ—Ä—è–¥–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º

2. **Handler Registry** (`handler_registry.py`) - —Ä–µ–µ—Å—Ç—Ä –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
   - –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞–º–∏
   - –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏

3. **Handler Factory** (`handler_factory.py`) - —Ñ–∞–±—Ä–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
   - –°–æ–∑–¥–∞–µ—Ç —Ü–µ–ø–æ—á–∫—É –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
   - –ò–Ω–∂–µ–∫—Ç–∏—Ä—É–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

4. **Concrete Handlers** (`concrete_handlers.py`) - –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
   - `ProxyHandler` - –ø–µ—Ä–µ—Å—ã–ª–∫–∞ –≤ –¥—Ä—É–≥–∏–µ –±—Ä–æ–∫–µ—Ä—ã
   - `TelegramHandler` - –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

1. –°–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç –æ—Ç MQTT –±—Ä–æ–∫–µ—Ä–∞
2. –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã —á–µ—Ä–µ–∑ `TopicRoutingService` (–ø–æ —Ç–æ–ø–∏–∫—É)
3. –í—ã–±–∏—Ä–∞–µ—Ç—Å—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ (`MessageProcessingStrategy`)
4. –°–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ —Ü–µ–ø–æ—á–∫—É –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:
   - `ProxyHandler` - –ø–µ—Ä–µ—Å—ã–ª–∞–µ—Ç –≤ –¥—Ä—É–≥–∏–µ –±—Ä–æ–∫–µ—Ä—ã (–µ—Å–ª–∏ —Ä–µ–∂–∏–º –Ω–µ PRIVATE)
   - `TelegramHandler` - –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ Telegram —Å–æ–≥–ª–∞—Å–Ω–æ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
5. –ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–∞ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ (`message_grouping_enabled=true`):
   - –°–æ–æ–±—â–µ–Ω–∏—è —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º `message_id` –≥—Ä—É–ø–ø–∏—Ä—É—é—Ç—Å—è
   - –ü–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∫–∞–∫ –Ω–æ–≤–æ–µ
   - –ü–æ—Å–ª–µ–¥—É—é—â–∏–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É—é—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, –¥–æ–±–∞–≤–ª—è—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –Ω–æ–≤—ã—Ö –Ω–æ–¥–∞—Ö-–ø–æ–ª—É—á–∞—Ç–µ–ª—è—Ö

**–†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã:**

- **PRIVATE** (`msh/private/{tg_id}`) - —Ç–æ–ª—å–∫–æ –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- **GROUP** (`msh/group`) - —Ç–æ–ª—å–∫–æ –≥—Ä—É–ø–ø–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- **ALL** (`msh`) - –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è (–∏ –≤ –≥—Ä—É–ø–ø—É, –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º)
- **PRIVATE_GROUP** (`msh/private/{tg_id}/group`) - –ª–∏—á–Ω—ã–µ + –≥—Ä—É–ø–ø–∞

**–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π:**

- –í Telegram –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Å–æ–æ–±—â–µ–Ω–∏—è —Ç–∏–ø–∞ `text`
- `nodeinfo` –∏ `position` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –¥–ª—è –∫—ç—à–∞, –Ω–æ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è
- –≠—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –æ–±–æ–∏—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ (JSON –∏ Protobuf)

#### `telegram_commands.py` - –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

**–ö–ª–∞—Å—Å:** `TelegramCommandsHandler`

–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç –±–æ—Ç—É –≤ –ª–∏—á–Ω–æ–º —á–∞—Ç–µ.

**–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:**

- `/start` - –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –∫—Ä–∞—Ç–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- `/help` - —Å–ø—Ä–∞–≤–∫–∞ –ø–æ –≤—Å–µ–º –∫–æ–º–∞–Ω–¥–∞–º
- `/status` - —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –±–æ—Ç–∞
  - –ü–æ–¥–∫–ª—é—á–µ–Ω –ª–∏ –∫ MQTT
  - –†–∞–±–æ—Ç–∞–µ—Ç –ª–∏ Telegram polling
  - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–∫—Å–∏-–±—Ä–æ–∫–µ—Ä–æ–≤
- `/info` - –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
  - ID –≥—Ä—É–ø–ø–æ–≤–æ–≥–æ —á–∞—Ç–∞
  - –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
  - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ MQTT –ø—Ä–æ–∫—Å–∏
- `/get_chat_id` - –ø–æ–ª—É—á–∏—Ç—å ID —Ç–µ–∫—É—â–µ–≥–æ —á–∞—Ç–∞
- `/id` - –ø–æ–ª—É—á–∏—Ç—å –≤–∞—à Telegram ID –∏ –ø—Ä–∏–º–µ—Ä –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ —Ç–æ–ø–∏–∫–∞
  - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤–∞—à user_id, username, –∏–º—è
  - –í—ã–≤–æ–¥–∏—Ç –ø—Ä–∏–º–µ—Ä —Ç–æ–ø–∏–∫–∞ –¥–ª—è –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `msh/private/123456789`)
- `/mode` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–º —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞
  - –ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–µ–∫—É—â–µ–≥–æ —Ä–µ–∂–∏–º–∞
  - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–µ–∂–∏–º–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–µ–∂–∏–º –∏–∑ —Ç–æ–ø–∏–∫–∞)

**–ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞:**

–ü–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –∫–æ–º–∞–Ω–¥—ã –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è, —Ä–∞–∑—Ä–µ—à–µ–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:
- –ï—Å–ª–∏ `TELEGRAM_ALLOWED_USER_IDS` –Ω–µ –∑–∞–¥–∞–Ω - –¥–æ—Å—Ç—É–ø —É –≤—Å–µ—Ö
- –ï—Å–ª–∏ –∑–∞–¥–∞–Ω - —Ç–æ–ª—å–∫–æ —É–∫–∞–∑–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏

**–ú–µ—Ç–æ–¥:** `register_handlers(bot)`

–†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –≤—Å–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –≤ –±–æ—Ç–µ.

---

### 5. Application (–û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è) - `src/application/`

–≠—Ç–æ "–¥–∏—Ä–∏–∂–µ—Ä –æ—Ä–∫–µ—Å—Ç—Ä–∞" - —É–ø—Ä–∞–≤–ª—è–µ—Ç –≤—Å–µ–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏.

#### `app.py` - –ì–ª–∞–≤–Ω—ã–π –∫–ª–∞—Å—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–ö–ª–∞—Å—Å:** `MeshtasticTelegramBotApp`

–°–æ–±–∏—Ä–∞–µ—Ç –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤–º–µ—Å—Ç–µ –∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:**

1. –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
2. –°–æ–∑–¥–∞–µ—Ç –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã:
   - `MQTTRepository` - –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å MQTT
   - `TelegramRepository` - –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Telegram
   - `MessageService` - –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
   - `NodeCacheService` - –¥–ª—è –∫—ç—à–∞ –Ω–æ–¥
   - `MQTTProxyService` - –¥–ª—è –ø–µ—Ä–µ—Å—ã–ª–∫–∏
   - `MQTTMessageHandler` - –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ MQTT
   - `TelegramCommandsHandler` - –¥–ª—è –∫–æ–º–∞–Ω–¥

**–ú–µ—Ç–æ–¥—ã:**

- `start()` - –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
  1. –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ MQTT –±—Ä–æ–∫–µ—Ä—É
  2. –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —Ç–æ–ø–∏–∫
  3. –ó–∞–ø—É—Å–∫–∞–µ—Ç Telegram polling (–ø–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥)
  4. –ó–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–∏—Å
  5. –ó–∞–ø—É—Å–∫–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É MQTT —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Ñ–æ–Ω–µ

- `stop()` - –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
  1. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç Telegram polling
  2. –û—Ç–∫–ª—é—á–∞–µ—Ç—Å—è –æ—Ç MQTT
  3. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–∏—Å
  4. –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –≤—Å–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

- `run_forever()` - –∑–∞–ø—É—Å–∫–∞–µ—Ç –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–æ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–∏–≥–Ω–∞–ª–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
  - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–∏–≥–Ω–∞–ª—ã (Ctrl+C, SIGTERM)
  - –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–≤–µ—Ä—à–∞–µ—Ç —Ä–∞–±–æ—Ç—É

**–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏:**

- `_subscribe_task` - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Ö–æ–¥—è—â–∏–µ MQTT —Å–æ–æ–±—â–µ–Ω–∏—è
- `_telegram_polling_task` - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã Telegram

---

### 6. Config (–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è) - `src/config.py`

–ó–¥–µ—Å—å —Ö—Ä–∞–Ω—è—Ç—Å—è –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

#### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–ª–∞—Å—Å—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

**`MQTTBrokerConfig`** - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ MQTT –±—Ä–æ–∫–µ—Ä–∞ (–∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö)

- `host` - –∞–¥—Ä–µ—Å –±—Ä–æ–∫–µ—Ä–∞ (`mosquitto` –¥–ª—è Docker, `localhost` –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞)
- `port` - –ø–æ—Ä—Ç (–æ–±—ã—á–Ω–æ 1883)
- `username` / `password` - –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è)
- `topic` - —Ç–æ–ø–∏–∫ –¥–ª—è –ø–æ–¥–ø–∏—Å–∫–∏ (`msh/#` –¥–ª—è –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π)
- `client_id` - –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∫–ª–∏–µ–Ω—Ç–∞
- `qos` - —É—Ä–æ–≤–µ–Ω—å –∫–∞—á–µ—Å—Ç–≤–∞ (0, 1 –∏–ª–∏ 2)

**`MQTTProxyTargetConfig`** - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–¥–Ω–æ–≥–æ –ø—Ä–æ–∫—Å–∏-–±—Ä–æ–∫–µ—Ä–∞

- `name` - –∏–º—è (–¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è)
- `host` / `port` - –∞–¥—Ä–µ—Å —Ü–µ–ª–µ–≤–æ–≥–æ –±—Ä–æ–∫–µ—Ä–∞
- `username` / `password` - –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- `topic_prefix` - –ø—Ä–µ—Ñ–∏–∫—Å –¥–ª—è —Ç–æ–ø–∏–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `enabled` - –≤–∫–ª—é—á–µ–Ω –ª–∏ —ç—Ç–æ—Ç –ø—Ä–æ–∫—Å–∏
- `qos` - —É—Ä–æ–≤–µ–Ω—å –∫–∞—á–µ—Å—Ç–≤–∞
- `tls` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å TLS/SSL —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ (–æ–±—ã—á–Ω–æ `true` –¥–ª—è –ø–æ—Ä—Ç–∞ 8883)
- `tls_insecure` - –æ—Ç–∫–ª—é—á–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è —Å–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã—Ö —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤, –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)

**`TelegramConfig`** - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Telegram –±–æ—Ç–∞

- `bot_token` - —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- `group_chat_id` - ID –≥—Ä—É–ø–ø–æ–≤–æ–≥–æ —á–∞—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `group_topic_id` - ID —Ç–µ–º—ã –≤ –≥—Ä—É–ø–ø–µ –¥–ª—è —Ñ–æ—Ä—É–º–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `allowed_user_ids` - —Å–ø–∏—Å–æ–∫ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `show_receive_time` - –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤—Ä–µ–º—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–∞–∂–¥–æ–π –Ω–æ–¥–æ–π –≤ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `false`)
- `message_grouping_enabled` - –≤–∫–ª—é—á–∏—Ç—å –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ `message_id` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `true`)
- `message_grouping_timeout` - —Ç–∞–π–º–∞—É—Ç –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 30)

**`MessageProcessingConfig`** - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π

- `default_mode` - —Ä–µ–∂–∏–º –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `private`, `group`, `all` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `group`)
- `group_mode_send_to_users` - –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —Ä–µ–∂–∏–º–µ GROUP (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `false`)
- `handlers` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ (–ø–æ—Ä—è–¥–æ–∫ –∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

**`AppConfig`** - –≥–ª–∞–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–°–æ–±–∏—Ä–∞–µ—Ç –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–º–µ—Å—Ç–µ.

**–ú–µ—Ç–æ–¥—ã:**

- `load_from_yaml(yaml_path)` - –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏–∑ YAML —Ñ–∞–π–ª–∞
  - –ï—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `.env`
  - –ï—Å–ª–∏ —Ñ–∞–π–ª –Ω–∞–π–¥–µ–Ω - –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç —Å `.env` (–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–º–µ—é—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

- `setup_logging()` - –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ .env —Ñ–∞–π–ª (–ø—Ä–æ—Å—Ç–æ–π)

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (—Å–º. `env.example`).

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ü—Ä–æ—Å—Ç–æ –∏ –ø–æ–Ω—è—Ç–Ω–æ
- –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –æ–¥–Ω–æ–≥–æ –ø—Ä–æ–∫—Å–∏-–±—Ä–æ–∫–µ—Ä–∞

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- –ù–µ—É–¥–æ–±–Ω–æ –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø—Ä–æ–∫—Å–∏-–±—Ä–æ–∫–µ—Ä–æ–≤

### –°–ø–æ—Å–æ–± 2: –ß–µ—Ä–µ–∑ YAML —Ñ–∞–π–ª (–ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π)

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `mqtt_config.yaml` –Ω–∞ –æ—Å–Ω–æ–≤–µ `mqtt_config.yaml.example`.

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –£–¥–æ–±–Ω–æ –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø—Ä–æ–∫—Å–∏-–±—Ä–æ–∫–µ—Ä–æ–≤
- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å/—É–¥–∞–ª—è—Ç—å –±—Ä–æ–∫–µ—Ä—ã

**–ü—Ä–∏–º–µ—Ä:**

```yaml
mqtt_source:
  host: mosquitto
  port: 1883
  topic: msh/#
  payload_format: json  # json | protobuf | both
  qos: 1

mqtt_proxy_targets:
  - name: cloud_broker
    host: cloud.mqtt.example.com
    port: 1883
    username: user1
    password: pass1
    enabled: true
    qos: 1
    tls: false  # –û–±—ã—á–Ω—ã–π MQTT (–ø–æ—Ä—Ç 1883)
  
  - name: secure_broker
    host: secure.mqtt.example.com
    port: 8883  # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ—Ä—Ç –¥–ª—è MQTT over TLS
    username: user2
    password: pass2
    enabled: true
    qos: 1
    tls: true  # –í–∫–ª—é—á–∏—Ç—å TLS –¥–ª—è –ø–æ—Ä—Ç–∞ 8883
    tls_insecure: false  # –ü—Ä–æ–≤–µ—Ä—è—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
  
  - name: internal_broker
    host: internal.mqtt.local
    port: 8883
    enabled: true
    qos: 1
    tls: true
    tls_insecure: true  # –û—Ç–∫–ª—é—á–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –¥–ª—è —Å–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω–æ–≥–æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫:**

1. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (`.env`) - –Ω–∞–∏–≤—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
2. YAML —Ñ–∞–π–ª - —Å—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
3. –ó–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é - –Ω–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

---

## üîß –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ë–æ—Ç –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

**–û—à–∏–±–∫–∞:** "TELEGRAM_BOT_TOKEN –Ω–µ –∑–∞–¥–∞–Ω"

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ñ–∞–π–ª `.env` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–æ–∫–µ–Ω —É–∫–∞–∑–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ (–±–µ–∑ –∫–∞–≤—ã—á–µ–∫)
3. –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä: `docker-compose build telegram-bot && docker-compose up -d`

### –ë–æ—Ç –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –Ω–æ–¥—ã

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**

1. **–ù–æ–¥–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∞ –∫ –±—Ä–æ–∫–µ—Ä—É?**
   ```bash
   docker-compose logs mosquitto | grep "New client connected"
   ```
   –î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤–∞—à–µ–π –Ω–æ–¥—ã.

2. **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π IP –∞–¥—Ä–µ—Å?**
   - –í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –Ω–æ–¥—ã –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å IP –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
   - –ù–æ–¥–∞ –∏ —Å–µ—Ä–≤–µ—Ä –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ –æ–¥–Ω–æ–π —Å–µ—Ç–∏ Wi-Fi

3. **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–æ–ø–∏–∫?**
   - –í –Ω–æ–¥–µ: `msh` (–±–µ–∑ —Ä–µ—à–µ—Ç–∫–∏ - –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è)
   - –í –±–æ—Ç–µ: `msh/‚Ññ` (—Å —Ä–µ—à–µ—Ç–∫–æ–π - –ø–æ–ª—É—á–∞–µ—Ç –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è)
   - –ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ñ–æ—Ä–º–∞—Ç (JSON –∏–ª–∏ Protobuf) –ø–æ —Ç–æ–ø–∏–∫—É

4. **–ü–æ—Ä—Ç –æ—Ç–∫—Ä—ã—Ç?**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π—Ä–≤–æ–ª
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ—Ä—Ç 1883 –¥–æ—Å—Ç—É–ø–µ–Ω

### –°–æ–æ–±—â–µ–Ω–∏—è –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ Telegram

1. **–ë–æ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –≥—Ä—É–ø–ø—É?**
   - –î–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø—É
   - –î–∞–π—Ç–µ –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

2. **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π ID —á–∞—Ç–∞?**
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É `/get_chat_id` –≤ –≥—Ä—É–ø–ø–µ
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ ID –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `-`)

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:**
   ```bash
   docker-compose logs -f telegram-bot
   ```
   –ò—â–∏—Ç–µ –æ—à–∏–±–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π.

### –ü—Ä–æ–∫—Å–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–ü—Ä–æ–∫—Å–∏ –≤–∫–ª—é—á–µ–Ω?**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `MQTT_PROXY_TARGET_ENABLED=true` –≤ `.env`
   - –ò–ª–∏ `enabled: true` –≤ YAML

2. **–ë—Ä–æ–∫–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω?**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–¥—Ä–µ—Å –∏ –ø–æ—Ä—Ç
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±—Ä–æ–∫–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:**
   ```bash
   docker-compose logs telegram-bot | grep proxy
   ```

### –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

–ï—Å–ª–∏ –≤—ã –∏–∑–º–µ–Ω–∏–ª–∏ –∫–æ–¥ –∏ —Ö–æ—Ç–∏—Ç–µ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è:

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose down

# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑ –±–æ—Ç–∞
docker-compose build telegram-bot

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞–Ω–æ–≤–æ
docker-compose up -d

# –ò–ª–∏ –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π:
docker-compose up --build -d
```

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

**–õ–æ–≥–∏ –±–æ—Ç–∞:**
```bash
docker-compose logs -f telegram-bot
```

**–õ–æ–≥–∏ MQTT –±—Ä–æ–∫–µ—Ä–∞:**
```bash
docker-compose logs -f mosquitto
```

**–í—Å–µ –ª–æ–≥–∏:**
```bash
docker-compose logs -f
```

### –£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

–í —Ñ–∞–π–ª–µ `.env` –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:

```env
LOG_LEVEL=DEBUG  # –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ, –≤–∫–ª—é—á–∞—è –æ—Ç–ª–∞–¥–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
LOG_LEVEL=INFO   # –û–±—ã—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
LOG_LEVEL=WARNING # –¢–æ–ª—å–∫–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –∏ –æ—à–∏–±–∫–∏
LOG_LEVEL=ERROR  # –¢–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞

**–°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:**
```bash
docker-compose ps
```

**Health checks:**
Docker –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–¥–æ—Ä–æ–≤—å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤. –ï—Å–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ–∑–¥–æ—Ä–æ–≤ - –æ–Ω –±—É–¥–µ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω.

---

## üéØ –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### Docker Compose

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å
docker-compose up -d

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
docker-compose down

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
docker-compose restart telegram-bot

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f telegram-bot

# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å
docker-compose build telegram-bot

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ (–≤–∫–ª—é—á–∞—è –¥–∞–Ω–Ω—ã–µ)
docker-compose down -v
```

### –†–∞–±–æ—Ç–∞ —Å –∫—ç—à–µ–º –Ω–æ–¥

–ö—ç—à –Ω–æ–¥ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ `data/nodes_cache.json`. –í—ã –º–æ–∂–µ—Ç–µ:

- –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ (—Ç–µ–∫—Å—Ç–æ–≤—ã–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–º)
- –£–¥–∞–ª–∏—Ç—å –¥–ª—è —Å–±—Ä–æ—Å–∞ –∫—ç—à–∞
- –í—Ä—É—á–Ω—É—é –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å (–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ù–µ –ø—É–±–ª–∏–∫—É–π—Ç–µ `.env` —Ñ–∞–π–ª**
   - –û–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–µ–∫—Ä–µ—Ç—ã (—Ç–æ–∫–µ–Ω—ã, –ø–∞—Ä–æ–ª–∏)
   - –£–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω –≤ `.gitignore`

2. **–ù–µ –ø—É–±–ª–∏–∫—É–π—Ç–µ `mqtt_config.yaml`**
   - –ú–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ø–∞—Ä–æ–ª–∏
   - –£–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω –≤ `.gitignore`

3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∏–ª—å–Ω—ã–µ –ø–∞—Ä–æ–ª–∏**
   - –î–ª—è MQTT –±—Ä–æ–∫–µ—Ä–∞ (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è)
   - –î–ª—è –ø—Ä–æ–∫—Å–∏-–±—Ä–æ–∫–µ—Ä–æ–≤

4. **–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø**
   - –ù–∞—Å—Ç—Ä–æ–π—Ç–µ `TELEGRAM_ALLOWED_USER_IDS`
   - –ù–µ –¥–∞–≤–∞–π—Ç–µ –≤—Å–µ–º –¥–æ—Å—Ç—É–ø –∫ –∫–æ–º–∞–Ω–¥–∞–º –±–æ—Ç–∞

5. **–§–∞–π—Ä–≤–æ–ª**
   - –û—Ç–∫—Ä–æ–π—Ç–µ —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ—Ä—Ç—ã (1883 –¥–ª—è MQTT)
   - –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –ø–æ—Ä—Ç—É 1883 —Ç–æ–ª—å–∫–æ –≤–∞—à–µ–π –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏

---

## üìù FAQ (–ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã)

**Q: –°–∫–æ–ª—å–∫–æ –ø—Ä–æ–∫—Å–∏-–±—Ä–æ–∫–µ—Ä–æ–≤ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å?**  
A: –ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ! –î–æ–±–∞–≤–ª—è–π—Ç–µ —Å—Ç–æ–ª—å–∫–æ, —Å–∫–æ–ª—å–∫–æ –Ω—É–∂–Ω–æ.

**Q: –ú–æ–∂–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–µ–∑ Docker?**  
A: –î–∞, –Ω–æ –Ω—É–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Python 3.11+ –∏ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏. –°–º. —Ä–∞–∑–¥–µ–ª "–õ–æ–∫–∞–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞" –≤ —Å—Ç–∞—Ä–æ–º README.

**Q: –ö–∞–∫ —á–∞—Å—Ç–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫—ç—à –Ω–æ–¥?**  
A: **–ò–º–µ–Ω–∞ –Ω–æ–¥ (longname, shortname) –≤—Å–µ–≥–¥–∞ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏** –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ `nodeinfo`. –ù–∞ –¥–∏—Å–∫ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Ä–∞–∑ –≤ 3 –¥–Ω—è (—á—Ç–æ–±—ã –Ω–µ –∏–∑–Ω–∞—à–∏–≤–∞—Ç—å –¥–∏—Å–∫). –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ –≤—Å–µ–≥–¥–∞, –Ω–∞ –¥–∏—Å–∫ - —Ä–∞–∑ –≤ 3 –¥–Ω—è.

**Q: –ß—Ç–æ —Ç–∞–∫–æ–µ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π?**  
A: –ö–æ–≥–¥–∞ –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—É—á–∞—é—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –Ω–æ–¥, –±–æ—Ç –≥—Ä—É–ø–ø–∏—Ä—É–µ—Ç –∏—Ö –≤ –æ–¥–Ω–æ Telegram —Å–æ–æ–±—â–µ–Ω–∏–µ. –í–º–µ—Å—Ç–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –≤—ã –≤–∏–¥–∏—Ç–µ –æ–¥–Ω–æ —Å –∫–æ–º–ø–∞–∫—Ç–Ω—ã–º —Å–ø–∏—Å–∫–æ–º –≤—Å–µ—Ö –Ω–æ–¥-–ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π. –ú–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å —á–µ—Ä–µ–∑ `TELEGRAM_MESSAGE_GROUPING_ENABLED`.

**Q: –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç —Ä–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞?**  
A: –ë–æ—Ç –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ MQTT —Ç–æ–ø–∏–∫–∞:
- `msh` - —Ä–µ–∂–∏–º ALL (–≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è)
- `msh/private/{tg_id}` - —Ä–µ–∂–∏–º PRIVATE (—Ç–æ–ª—å–∫–æ –ª–∏—á–Ω—ã–µ)
- `msh/group` - —Ä–µ–∂–∏–º GROUP (—Ç–æ–ª—å–∫–æ –≥—Ä—É–ø–ø–∞)
- `msh/private/{tg_id}/group` - —Ä–µ–∂–∏–º PRIVATE_GROUP (–ª–∏—á–Ω—ã–µ + –≥—Ä—É–ø–ø–∞)

–í—ã –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ä–µ–∂–∏–º —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É `/mode` –≤ Telegram.

**Q: –ü–æ—á–µ–º—É –Ω–µ –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ø–∞–¥–∞—é—Ç –≤ Telegram?**  
A: –í Telegram –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Å–æ–æ–±—â–µ–Ω–∏—è —Ç–∏–ø–∞ `text`. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è (`nodeinfo`, `position`) –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –¥–ª—è –∫—ç—à–∞, –Ω–æ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è. –≠—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –æ–±–æ–∏—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ - JSON –∏ Protobuf. –¢–∞–∫–∂–µ —Å–æ–æ–±—â–µ–Ω–∏—è –º–æ–≥—É—Ç –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã (PRIVATE/GROUP/ALL) –∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏.

**Q: –ö–∞–∫–æ–π —Ñ–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å - JSON –∏–ª–∏ Protobuf?**  
A: –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è JSON (`payload_format=json`). Protobuf –±–æ–ª–µ–µ –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π. –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ (`payload_format=both`), –Ω–æ —ç—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—é —Å–æ–æ–±—â–µ–Ω–∏–π, —Ç–∞–∫ –∫–∞–∫ Meshtastic —á–∞—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –ø–∞–∫–µ—Ç –≤ –æ–±–æ–∏—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö.

**Q: –ú–æ–∂–Ω–æ –ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏–π?**  
A: –î–∞, –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –º–µ—Ç–æ–¥ `format_for_telegram()` –≤ —Ñ–∞–π–ª–µ `src/domain/message.py`.

**Q: –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ–∫—Å–∏-–±—Ä–æ–∫–µ—Ä?**  
A: –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å –≤ `mqtt_config.yaml` –≤ —Å–µ–∫—Ü–∏—é `mqtt_proxy_targets` –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —Å –¥—Ä—É–≥–∏–º –ø—Ä–µ—Ñ–∏–∫—Å–æ–º.

---

## üèõÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –≥–∏–±–∫–æ—Å—Ç–∏ –∏ —Ä–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç–∏:

### Strategy Pattern
–†–∞–∑–ª–∏—á–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π (`MessageProcessingStrategy`):
- `PrivateModeStrategy` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ª–∏—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- `GroupModeStrategy` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≥—Ä—É–ø–ø–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- `AllModeStrategy` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

### Chain of Responsibility
–¶–µ–ø–æ—á–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ (`MessageHandler`):
- –ö–∞–∂–¥—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–ª–∏ –ø–µ—Ä–µ–¥–∞—Ç—å —Å–ª–µ–¥—É—é—â–µ–º—É
- –ü–æ—Ä—è–¥–æ–∫ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### Registry Pattern
–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Ä–µ–µ—Å—Ç—Ä –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ (`HandlerRegistry`):
- –£–ø—Ä–æ—â–∞–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

### Factory Pattern
–§–∞–±—Ä–∏–∫–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π (`HandlerFactory`):
- –ò–Ω–∫–∞–ø—Å—É–ª–∏—Ä—É–µ—Ç –ª–æ–≥–∏–∫—É —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤
- –£–ø—Ä–æ—â–∞–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏

### Adapter Pattern
–ê–¥–∞–ø—Ç–µ—Ä –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ (`MessageHandlerAdapter`):
- –ê–¥–∞–ø—Ç–∏—Ä—É–µ—Ç –Ω–æ–≤—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É

## üöÄ –î–∞–ª—å–Ω–µ–π—à–µ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ

–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ —É–ª—É—á—à–∏—Ç—å –ø—Ä–æ–µ–∫—Ç:

1. –î–æ–±–∞–≤—å—Ç–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é —Å–æ–æ–±—â–µ–Ω–∏–π (–ø–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—é, —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É)
2. –†–µ–∞–ª–∏–∑—É–π—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–æ—Ç–æ–º —á–µ—Ä–µ–∑ Telegram
3. –î–æ–±–∞–≤—å—Ç–µ –º–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (Prometheus, Grafana)
4. –°–æ–∑–¥–∞–π—Ç–µ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
5. –î–æ–±–∞–≤—å—Ç–µ –ø–æ–¥–¥–µ—Ä–∂–∫—É –¥—Ä—É–≥–∏—Ö –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, HTTP API)
6. –†–∞—Å—à–∏—Ä—å—Ç–µ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –≤—Ä–µ–º–µ–Ω–∏)

---

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–°–º. —Ñ–∞–π–ª [LICENSE](LICENSE)

---

## üôè –ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏

–°–ø–∞—Å–∏–±–æ –≤—Å–µ–º, –∫—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —ç—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç! –ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è - —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ Issues –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.

**–£–¥–∞—á–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å Meshtastic!** üì°
